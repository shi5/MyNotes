---
date created: 2023-10-25 19:49
---

# 数据库

## 大数据量

- 根据系统设计的假设，12306 的注册用户规模约为 10 亿，每年新增用户约 500 万。
- 单机 MySQL 数据库的处理能力，需使用**分库分表**或**分布式数据库**来支撑海量数据。
- 分布式数据库普及率低，目前多使用[[分库分表技术]]

### 业务难点

- 会员多种登录类型：参见[[分库分表技术#水平分表]]
- 会员注册缓存穿透：[[布隆过滤器]]+重用用户表 （？

## 数据库表

### 用户相关

![](https://cdn.nlark.com/yuque/0/2023/jpeg/331027/1690702094967-ffa524a7-5fe6-41ca-8a08-d2630ca6152d.jpeg)

核心：
- t_user 会员数据表：存储会员账号、密码、证件号、邮箱、手机号等信息
- t_user_mail 会员邮箱数据表：存储会员邮箱和用户名的关系
- t_user_phone 会员手机号数据表：存储会员手机号和用户名的关系

> t_user_mail和t_user_phone 用于解决分库分表带来的问题，作为路由表

---

- t_user_reuse 用户名可复用表：存储已被注销的可用用户名
	- **用来解决布隆过滤器无法删除的问题**
- t_user_deletion：用户证件号注销表：存储被注销过得证件号记录数据
	- 用来解决用户恶意注销 12306 账号的问题。
	- 假设，一个用户用一个证件号反复注册并注销，是不是应该把他拉入黑名单。因为用户名每次注册都可以使用新的，所以说我们只能针对证件号当做依据。目前系统的规则是，如果同一个证件号注销超过 5 次，就拉入黑名单不再支持注册。

---

- t_passenger：乘车人数据表
	- 一个用户可以多名乘车人，可以用来买票时选择多人购票。用户表和乘车人表之间通过用户名进行关联，一对多的关联关系。

### 列车相关

- t_train：列车表，存储每天生成的行驶列车数据。
- t_carriage：列车车厢表，存储每趟列车对应的车厢数据，包括车厢类型。
- t_train_station：列车站点表，存储列车行驶站点顺序表。
- t_train_station_relation：列车站点关联表，存储列车行驶站点关联关系表。
	- 这是一个会把所有车站都会关联起来的数据集合，存储的数据模型如下所示：
	- ![[Pasted image 20231025195552.png]]
- t_train_station_price：列车站点价格表，存储列车站点关联关系不同座位价格表。

### 订单相关

- t_order：订单主表，用户购买的单次车票，就对应一个订单。但是有可能一个订单中会有多个乘车人，所以还会有订单明细表。
- t_order_item：订单明细表，一个订单可能有多个乘车人，多个乘车人就对应多个订单明细。
- t_order_item_passenger：订单明细乘车人表，因为订单表和订单明细表分库分表规则所致，乘车人无法查看本人车票订单，所以创建了这个关联表。通过证件号关联订单。
	- 通过证件号关联是为了**乘车人**查询自己的车票

### 支付相关

- t_pay：订单支付表，存储用户支付车票相关数据。