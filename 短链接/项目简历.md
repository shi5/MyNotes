## 应用场景

- 基于Java的短链接管理系统：
	- 主要包括：用户登录注册、短链接创建修改、短链接分组管理、短链接访问监控等模块
	- 使用布隆过滤器来保证短链接的唯一性，性能优于分布式锁搭配查询数据库方案
	- 使用ShardingSphere-JDBC对数据库分表，提升数据库在大数据量下的查询性能
	- 使用Redis缓存短链接与原始链接的跳转关系，减轻数据库压力，通过缓存预热及Redis分布式锁解决缓存击穿，并通过Redis存入无效Key解决缓存穿透
	- 借助RocketMQ消息队列进行流量削峰，实现大量访问短链接场景下的监控信息存储功能，并使用Redis完成幂等场景的处理，保障消息在一定时间内仅消费一次
	- 使用 Sentinel 进行接口访问的 QPS 限流，触发限流规则后进行降级处理，保障短链接系统稳定运行

## 消息队列

使用场景： 大量访问用户访问短链接时，需要记录相关的监控信息并保存到数据库中，此时需要两步：1. 需要从请求头中获取一系列信息，比如地区、IP、访问设备等；2. 保存相关的数据到 MySQL 数据库表。第一个问题只会使吞吐率下降能接受好，对于第二个问题，大量访问可能造成数据库服务宕机

这样也可以解决修改短链接时的OOM问题
### 为什么使用RocketMQ

RocketMQ 的设计更注重实现高可用和多功能的消息服务


## 布隆过滤器

核心参数：
- 预估数据容量：容量越大，布隆过滤器占的空间越大（短链接是一亿）
- 误判率：误判率越低，使用的哈希函数越多（短链接是千分之一）

使用场景：
1. 检查用户名是否存在
2. 短链接跳转（创建短链接时就加入）

扩容：
1. 创建一个新的大容量的布隆过滤器
2. 使用两个布隆过滤器进行判断

## ShardingSphere-JDBC

### 执行流程

1. SQL解析 
	- 词法解析 + 语法解析
	- 返回抽象语法树，并**标记可能改写的字段**
2. SQL路由
3. SQL改写
	- 改写表名
	- 改写字段
1. SQL执行
2. 结果归并

### 使用场景 



## Redis实现幂等

重复消费问题：
- 网络问题（抖动、丢包）
- 生产重试

解决方案：
1. 在Redis查询是否被消费
2. 若无，写入一个预占标识

## Sentinel 

使用场景：创建短链接